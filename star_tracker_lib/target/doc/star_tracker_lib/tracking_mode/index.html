<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="`tracking_mode` is the method of matching the stars found in the image to a database."><title>star_tracker_lib::tracking_mode - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="star_tracker_lib" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0-nightly (8771282d4 2023-07-23)" data-channel="nightly" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-6d2c9675f3d09c26.css" data-theme-dark-css="dark-45ceb8f2e522f4d1.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-6d2c9675f3d09c26.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-45ceb8f2e522f4d1.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../star_tracker_lib/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../star_tracker_lib/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module tracking_mode</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">star_tracker_lib</a>::<wbr><a class="mod" href="#">tracking_mode</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/star_tracker_lib/tracking_mode/mod.rs.html#1-508">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><code>tracking_mode</code> is the method of matching the stars found in the image to a database.</p>
<p>This program uses the pyramid method of star tracking.</p>
<h2 id="pyramid-tracking-mode-algorithm"><a href="#pyramid-tracking-mode-algorithm">Pyramid Tracking Mode Algorithm</a></h2>
<p>The pyramid method is one of the most reliable methods. It was developed by Mortari in 1997.<br />
The method was modified a few times.</p>
<h3 id="summary"><a href="#summary">Summary</a></h3>
<p>The algorithm creates a kernel (a set of 3 stars) with a method to reduce the number of times a false positive star is used.<br />
It then will compare the constellation with a k-vector table database.<br />
If it succeeds, it will then find another star and verify it is also consistent.</p>
<h4 id="creating-the-kernel"><a href="#creating-the-kernel">Creating the kernel</a></h4>
<p>To select the stars, a looping algorithm must be chosen the proposed method is implemented in this algorithm.<br />
This will access the index of 0-1-2, 2-3-4, 3-4-5, 1-2-4, 2-3-5, 1-2-5, 1-3-4, 2-4-5, 1-3-5, 1-4-5.<br />
This method is done to reduce the times a specific star is used as it may be a false star.</p>
<h4 id="using-the-kernel"><a href="#using-the-kernel">Using the kernel</a></h4>
<p>By working with the database, a set of star ‘pairs’ are found.<br />
These each pair contains the id/location of each star.<br />
By finding the common star from 2 pairs, the star can be identified in the database and the sample.<br />
The matched triangle will then have its specularity checked (check if it is flipped).</p>
<h4 id="pyramid"><a href="#pyramid">Pyramid</a></h4>
<p>If a correct kernel is found, an extra test is performed where another star is picked, finding the distance from this star to the other stars, this is then compared with the database.</p>
<h4 id="database"><a href="#database">Database</a></h4>
<p>Refer to <a href="database/mod">this file</a>.</p>
<h3 id="features"><a href="#features">Features</a></h3>
<p>This method features:</p>
<ul>
<li>An algorithm which can fit on a microcontroller.</li>
<li>Contains a method to reduce the repetition of using a false star.</li>
<li>Fast as uses K-Table.</li>
<li>Checks if the triangle is flipped (false positive).</li>
<li>Adds an extra star to verify correct identification opposing other triangle constellation based methods.</li>
</ul>
<h3 id="useful-links"><a href="#useful-links">Useful links:</a></h3>
<ul>
<li><a href="https://www.researchgate.net/publication/254199748_Lost-in-Space_Pyramid_Algorithm_for_Robust_Star_Pattern_Recognition">Original Paper</a></li>
<li><a href="https://arxiv.org/pdf/1808.08686.pdf#page=7">Pseudo Interpretation</a></li>
<li><a href="http://mtc-m21b.sid.inpe.br/col/sid.inpe.br/mtc-m21b/2017/08.10.22.44/doc/publicacao.pdf#page=105">Good Explanation</a></li>
</ul>
<h2 id="how-to-use"><a href="#how-to-use">How to Use</a></h2>
<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">use </span>star_tracker_lib::tracking_mode::database::MockDatabase;
<span class="kw">use </span>star_tracker_lib::tracking_mode::database::Database;
<span class="kw">use </span>star_tracker_lib::tracking_mode::AbandonSearchFailures;
<span class="kw">use </span>star_tracker_lib::tracking_mode::StarTriangleIterator;
<span class="kw">use </span>star_tracker_lib::tracking_mode::ConstellationResult;
<span class="kw">use </span>star_tracker_lib::tracking_mode::AbandonSearch;
<span class="kw">use </span>star_tracker_lib::tracking_mode::Constellation;
<span class="kw">use </span>star_tracker_lib::tracking_mode::Specularity;

<span class="kw">use </span>star_tracker_lib::util::units::Equatorial;
<span class="kw">use </span>star_tracker_lib::util::units::Degrees;
<span class="kw">use </span>star_tracker_lib::util::units::Vector3;
<span class="kw">use </span>star_tracker_lib::util::units::Match;
<span class="kw">use </span>star_tracker_lib::util::list::List;

<span class="comment">// To construct the database, use the tools in *star_tracker_nix*, look at demo.
</span><span class="kw">let </span>database_iterator = <span class="comment">// database goes here.


// Pretend these are image values which have been projected onto a unit sphere.
</span><span class="kw">let </span>stars_3d: Vec&lt;Equatorial&gt; = <span class="macro">vec!</span>[];

<span class="comment">// This is a way for increasing the speed of the algorithm.
// Just use an array size which is large and you can fit...
</span><span class="kw">const </span>SOME_LARGE_ARRAY_SIZE: usize = <span class="number">1000</span>;
<span class="kw">let </span>iterator = StarTriangleIterator::&lt;SOME_LARGE_ARRAY_SIZE&gt;::new();

<span class="comment">// The algorithm tries to create a triangle with a set of stars. 
// If the triangle is flipped, it is not a proper match.
// Specularity is a way of doing this.
// There is a min specularity where it is effectively a strait line.
// In this case, if the specularity is below this number, specularity is ignored.
// Specularity::default() has a good value, however if this isn&#39;t working for you, have a play around.
// Look in *Specularity* for more details.
</span><span class="kw">let </span>specularity = Specularity::default();

<span class="comment">// This will abort the program if it is taking too long.
// This abort uses the number of fails.
// The algorithm will try and construct a triangle with 3 stars, if it cannot, a fail occurs.
// This is set so if it cannot make a triangle 10 times in a row, it will abort.
// It is important to abort early as a success usually takes less than 5 times.
// The more fails, the more likely it will be incorrect and unreliable.
// You should also team this up with a timer, however this is not platform specific so make your own.
// There is a timer and fails counter abort in *star_tracker_nix* used by *demo*. 
</span><span class="kw">let </span>fails_good = <span class="number">10</span>;   <span class="comment">// Unsuccessful matches.
</span><span class="kw">let </span><span class="kw-2">mut </span>abort = AbandonSearchFailures::new(fails_good);


<span class="comment">// How inaccurate is the lens?
// You will need to test the lens.
// Use nova.astrometry.net and get the corr file, put it through corr_analyzer in star_tracker_nix.
// Don&#39;t use an error above 0.1 degrees as it will likely fail.
</span><span class="kw">let </span>angle_tolerance = Degrees(<span class="number">0.08</span>).to_radians();



<span class="comment">// The min and max (inclusive) required stars.
// If not enough stars can be formed into a constellation, the search will continue and will eventually fail.
// If there is too many stars in the constellation, the algorithm will end early on the upper bounds to save time.
// The pyramid method should use 4 stars, so it is set to 4.
</span><span class="kw">let </span>required_stars = <span class="number">4</span>..=<span class="number">4</span>;


<span class="kw">let </span><span class="kw-2">mut </span>output: Vec&lt;Match&lt;usize&gt;&gt; = Vec::new();


	<span class="kw">let </span>success = Constellation::find_all (
	<span class="kw-2">&amp;</span>stars_3d, <span class="kw-2">&amp;mut </span>database_iterator, <span class="kw-2">&amp;mut </span>iterator,
	<span class="kw-2">&amp;mut </span>specularity, <span class="kw-2">&amp;mut </span>abort, angle_tolerance, required_stars, <span class="kw-2">&amp;mut </span>output 
);

<span class="kw">match </span>success
{
	ConstellationResult::ErrorNoTriangleMatch      { fails } =&gt; 
		<span class="macro">println!</span>(<span class="string">&quot;FAILED: Could not match any stars; {} failures.&quot;</span>, fails),

	ConstellationResult::ErrorAborted              { fails } =&gt;
		<span class="macro">println!</span>(<span class="string">&quot;FAILED: Aborted due to AbandonSearch parameter; {} failures.&quot;</span>, fails),

	ConstellationResult::ErrorInsufficientPyramids { fails } =&gt;
		<span class="macro">println!</span>(<span class="string">&quot;FAILED: Not enough matched stars; {} failures.&quot;</span>, fails),

	ConstellationResult::Success                   { fails } =&gt;
		<span class="macro">println!</span>(<span class="string">&quot;SUCCESS; with {} fails.&quot;</span>, fails),
}</code></pre></div>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="constellation/index.html" title="mod star_tracker_lib::tracking_mode::constellation">constellation</a></div><div class="desc docblock-short">Implementation of Constellation.</div></li><li><div class="item-name"><a class="mod" href="database/index.html" title="mod star_tracker_lib::tracking_mode::database">database</a></div><div class="desc docblock-short">The database for the pyramid method is a set of 2 lookup tables (star pairs, star catalogue) and an equation (k-vector)</div></li><li><div class="item-name"><a class="mod" href="kernel_iterator/index.html" title="mod star_tracker_lib::tracking_mode::kernel_iterator">kernel_iterator</a></div><div class="desc docblock-short">Implementation for KernelIterator</div></li><li><div class="item-name"><a class="mod" href="pilot_finder/index.html" title="mod star_tracker_lib::tracking_mode::pilot_finder">pilot_finder</a></div><div class="desc docblock-short">Implementation of StarPyramid.</div></li><li><div class="item-name"><a class="mod" href="specularity/index.html" title="mod star_tracker_lib::tracking_mode::specularity">specularity</a></div><div class="desc docblock-short">Implementation for Specularity</div></li><li><div class="item-name"><a class="mod" href="star_pair/index.html" title="mod star_tracker_lib::tracking_mode::star_pair">star_pair</a></div><div class="desc docblock-short">Implementation for KernelIterator</div></li><li><div class="item-name"><a class="mod" href="star_triangle/index.html" title="mod star_tracker_lib::tracking_mode::star_triangle">star_triangle</a></div><div class="desc docblock-short">Implementation of StarTriangle</div></li><li><div class="item-name"><a class="mod" href="star_triangle_iterator/index.html" title="mod star_tracker_lib::tracking_mode::star_triangle_iterator">star_triangle_iterator</a></div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.AbandonSearchFailures.html" title="struct star_tracker_lib::tracking_mode::AbandonSearchFailures">AbandonSearchFailures</a></div><div class="desc docblock-short">A type of AbandonSearch </div></li><li><div class="item-name"><a class="struct" href="struct.KernelIterator.html" title="struct star_tracker_lib::tracking_mode::KernelIterator">KernelIterator</a></div><div class="desc docblock-short">An iterator which reduces the chances of getting the same false star twice. </div></li><li><div class="item-name"><a class="struct" href="struct.PilotFinder.html" title="struct star_tracker_lib::tracking_mode::PilotFinder">PilotFinder</a></div><div class="desc docblock-short">Use to search for a pilot star to match a star triangle.</div></li><li><div class="item-name"><a class="struct" href="struct.Specularity.html" title="struct star_tracker_lib::tracking_mode::Specularity">Specularity</a></div><div class="desc docblock-short">Ensures the constellation is the correct orientation.</div></li><li><div class="item-name"><a class="struct" href="struct.StarPair.html" title="struct star_tracker_lib::tracking_mode::StarPair">StarPair</a></div><div class="desc docblock-short">A set of 2 stars in equatorial space, this represents a line / angle.</div></li><li><div class="item-name"><a class="struct" href="struct.StarPyramid.html" title="struct star_tracker_lib::tracking_mode::StarPyramid">StarPyramid</a></div><div class="desc docblock-short">A set of 4 stars in 3D space, this represents a pyramid.</div></li><li><div class="item-name"><a class="struct" href="struct.StarTriangle.html" title="struct star_tracker_lib::tracking_mode::StarTriangle">StarTriangle</a></div><div class="desc docblock-short">A set of 3 stars in T space, this represents a triangle. </div></li><li><div class="item-name"><a class="struct" href="struct.StarTriangleIterator.html" title="struct star_tracker_lib::tracking_mode::StarTriangleIterator">StarTriangleIterator</a></div><div class="desc docblock-short">A way of speeding up the database search algorithm.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Constellation.html" title="enum star_tracker_lib::tracking_mode::Constellation">Constellation</a></div><div class="desc docblock-short">The return type for the star pyramid.</div></li><li><div class="item-name"><a class="enum" href="enum.ConstellationResult.html" title="enum star_tracker_lib::tracking_mode::ConstellationResult">ConstellationResult</a></div><div class="desc docblock-short">The output from <a href="enum.Constellation.html#method.find_all" title="associated function star_tracker_lib::tracking_mode::Constellation::find_all">find_all</a>.</div></li><li><div class="item-name"><a class="enum" href="enum.SpecularityResult.html" title="enum star_tracker_lib::tracking_mode::SpecularityResult">SpecularityResult</a></div><div class="desc docblock-short">A specularity test.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.AbandonSearch.html" title="trait star_tracker_lib::tracking_mode::AbandonSearch">AbandonSearch</a></div><div class="desc docblock-short">Used to tell the search that it should give up.</div></li><li><div class="item-name"><a class="trait" href="trait.PyramidConstruct.html" title="trait star_tracker_lib::tracking_mode::PyramidConstruct">PyramidConstruct</a></div><div class="desc docblock-short">Used to find the pilot star for the found star triangle.</div></li><li><div class="item-name"><a class="trait" href="trait.RegionCompare.html" title="trait star_tracker_lib::tracking_mode::RegionCompare">RegionCompare</a></div><div class="desc docblock-short">Use to compare regions.</div></li><li><div class="item-name"><a class="trait" href="trait.SpecularityConstruct.html" title="trait star_tracker_lib::tracking_mode::SpecularityConstruct">SpecularityConstruct</a></div><div class="desc docblock-short">Used to check the specularity of a star triangle.</div></li><li><div class="item-name"><a class="trait" href="trait.TriangleConstruct.html" title="trait star_tracker_lib::tracking_mode::TriangleConstruct">TriangleConstruct</a></div><div class="desc docblock-short">Used to iterate over star triangles until a match is found.</div></li></ul></section></div></main></body></html>